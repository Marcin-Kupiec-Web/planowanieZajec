
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/templates/BasicTemplate.html">
	<ui:define name="styleCSS"><h:outputStylesheet name="css/planZajec.css" /></ui:define>	
		<ui:define name="content">
				<!-- dialog do dodawania nowych dni wolnlych -->
		<p:dialog header="Rejestracja dnia wolnego" id="rdd" widgetVar="dlgRejestracjaDnia" 
		class="shadow" appendTo="@(body)" style="background:white;">
		<p:ajax event="close"  update="rdd" resetValues="true" />
				<h:form style="text-align:center" id="dniWolneDialog">
						<h:panelGrid columns="2" >
								<h:outputLabel>Dzień </h:outputLabel>
										<p:calendar value="#{wolneDni.dw}" locale="pl"  size="10" pattern="dd-MM-yyyy" effect="fade" required="true"/>
								<h:outputLabel>Komentarz: </h:outputLabel>
										<p:inputTextarea value="#{wolneDni.komentarz}" required="true"/>
						</h:panelGrid>
						<p:commandButton  action="#{wolneDni.addDzien()}" value="Zapisz" update=":formDniWolne, dniWolneDialog" icon="ui-icon-calculator"  style="margin:20px;width:90%;padding:5px"/>
				</h:form>	
		</p:dialog>
		
		
		<h:form id="formDniWolne">
					<p:growl id="msgs" showDetail="false"/>
				<p:dataTable id="dw" var="dzienWolny" value="#{wolneDni.dwl}" editable="true"  rowKey="#{dzienWolny.id_dniWolne}" 
				expandedRow="false" sortBy="#{dzienWolny.miesiac}" class="shadow my-tab-hover my-tab" selection="true"
				expandableRowGroups="true" style="text-align:center;width:85%;margin:auto">
				<f:facet name="header">
						<div class="headerPanel0">
        						<h:outputLabel value="Dni wolne" />
        				</div>
        				<div style="display:inline-block;float:right">
								<p:selectOneMenu id="rok" value="#{wolneDni.rokWybrany}"
									lazy="true" required="true" >
									  <p:ajax event="change" update="formDniWolne, rdd" listener="#{wolneDni.changeYear()}" />
									<f:selectItems value="#{wolneDni.lata}" />
								</p:selectOneMenu>
										<p:commandButton value="Dodaj" rendered="#{poziomUprawnien eq 1 or (poziomUprawnien eq 6)}" 
										onclick="PF('dlgRejestracjaDnia').show();" style="margin:0 10px 0 10px"/>
										<p:commandButton value="Generuj autom."  action="#{wolneDni.dodajDzienWolnyAuto}" 
										rendered="#{poziomUprawnien eq 1 or (poziomUprawnien eq 6)}" update="@form" onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()"/>
							
						</div>
						<div style="clear:both"></div>
        		</f:facet>
        		<p:ajax event="rowEdit" listener="#{wolneDni.onRowEdit}" update=":formDniWolne:msgs"/>
        		<p:headerRow>
        		<p:column headerText="Dzien" colspan="#{poziomUprawnien eq 1 or (poziomUprawnien eq 6)==true?5:2}" style="text-align:left">
									<h:outputText  value="#{wolneDni.miesiace[dzienWolny.miesiac]} (#{wolneDni.dwl.stream().filter(fl->fl.miesiac==dzienWolny.miesiac).count()})"/>
				</p:column>
        		</p:headerRow>
				<p:column headerText="Dzien">
					<p:cellEditor>
						<f:facet name="output">
									<h:outputText  value="#{dzienWolny.dzien}">
										<f:convertDateTime pattern="dd-MM-yyyyy"/>
									</h:outputText>
						</f:facet>
						<f:facet name="input">	
								<p:calendar value="#{dzienWolny.dzien}" locale="pl" required="true" size="10" pattern="dd-MMM-yyyy" effect="fade" />
						</f:facet>
					</p:cellEditor>
				</p:column>
				<p:column headerText="Komentarz" >
					<p:cellEditor>
						<f:facet name="output"><h:outputText  value="#{dzienWolny.komentarz}"/></f:facet>
						<f:facet name="input"><p:inputText  value="#{dzienWolny.komentarz}" required="true"/></f:facet>
					</p:cellEditor>
				</p:column>
				<p:column headerText="Id" style="width:70px" rendered="#{poziomUprawnien eq 1 or (poziomUprawnien eq 6)}">
									<h:outputText  value="#{dzienWolny.id_dniWolne}"/>
				</p:column>
				<p:column style="width:55px;text-align:center" rendered="#{poziomUprawnien eq 1 or (poziomUprawnien eq 6)}" >
									<f:facet name="header"><i  class="fa fa-eraser"></i></f:facet>
									<p:commandButton icon="fa fa-cut" actionListener="#{wolneDni.remove}"  update="@form" class="buttDelete"> 
											<f:attribute name="removeRow" value="#{dzienWolny}" />
											<p:confirm  header=" Uwaga, próbujesz usunac wpis!" message=" Czy potwierdzasz? " />
									</p:commandButton>
				</p:column>
				<p:column style="width:55px;text-align:center" rendered="#{poziomUprawnien eq 1 or (poziomUprawnien eq 6)}">
							<f:facet name="header"><i  class="fa fa-edit"></i></f:facet>
								<p:rowEditor />
				</p:column>
				<p:summaryRow>
					<p:column colspan="#{poziomUprawnien eq 1 or (poziomUprawnien eq 6)==true?3:1}" style="text-align:right">
							<h:outputText  value="Łacznie: "/>
					</p:column>
					<p:column style="text-align:left" colspan="#{poziomUprawnien eq 1 or (poziomUprawnien eq 6)==true?2:1}">
						<h:outputText value="#{wolneDni.dwl.stream().filter(fl->fl.miesiac==dzienWolny.miesiac).count()}"></h:outputText>
					</p:column>
				</p:summaryRow>
				</p:dataTable>
				<p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
      							  <p:commandButton value="Tak" type="button" styleClass="ui-confirmdialog-yes bg-danger" icon="fa fa-check" />
       							  <p:commandButton value="Nie" type="button" styleClass="ui-confirmdialog-no bg-primary" icon="fa fa-times" />
   				</p:confirmDialog>  
		</h:form>
		<p:dialog widgetVar="statusDialog" modal="true" draggable="false" closable="false" resizable="false" showHeader="false" style="background:whitesmoke;opacity:0.9">
										<p:graphicImage name="/img/loadery/load1.gif" width="100"/>
								</p:dialog>
	 </ui:define>
	<ui:define name="footer">
	</ui:define>
	
</ui:composition>

