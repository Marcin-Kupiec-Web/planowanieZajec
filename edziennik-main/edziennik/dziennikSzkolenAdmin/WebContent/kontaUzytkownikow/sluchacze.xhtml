
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/templates/BasicTemplate.html">
	<h:outputScript library="js" name="BasicTemplate.js" />
	<ui:define name="leftPane">
	</ui:define>
		<ui:define name="content" >
		<h:panelGroup rendered="#{poziomUprawnien eq 1}" >
		
	<p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
        <p:commandButton value="Tak" type="button" styleClass="ui-confirmdialog-yes bg-danger" icon="fa fa-check" />
        <p:commandButton value="Nie" type="button" styleClass="ui-confirmdialog-no bg-primary" icon="fa fa-times" />
    </p:confirmDialog>  
    
		<p:dialog header="Rejestracja osoby" id="rejOs" widgetVar="dlgRejestracjaOsoby"  modal="true"  appendTo="@(body)" style="background:white" >
		<p:ajax event="close" update="rejOs" resetValues="true" listener="#{sluchaczManager.clearForm}"/>
		<h:form>
			<h:panelGrid columns="6" id="dialogUserStudent">
			<h:outputLabel>Komp./Plut./Szkol.</h:outputLabel>
			<h:panelGrid columns="6">
					<p:selectOneMenu id="kompania" value="#{sluchaczManager.kompania}" lazy="true" required="true" style="min-width:30px">
					    		<p:ajax event="change" listener="#{sluchaczManager.changeKompania}" update="rejOs" 
					    				oncomplete="PF('dlgRejestracjaOsoby').show();" />
					    		<f:selectItem />
					        	 <f:selectItems value="#{sluchaczManager.kompanieListNazwa}"/> 
					</p:selectOneMenu>
					<p:selectOneMenu  value="#{sluchaczManager.pluton}" lazy="true" required="true" style="min-width:30px">
					    <p:ajax event="change" listener="#{sluchaczManager.changePluton}" update="rejOs" oncomplete="PF('dlgRejestracjaOsoby').show();"/>
					    	<f:selectItem />
					         <f:selectItems value="#{sluchaczManager.plutonListNazwa}"/> 
					    </p:selectOneMenu>
					    <p:selectOneMenu value="#{sluchaczManager.szkolenie}" lazy="true" required="true" style="min-width:70px">
					    <p:ajax event="change" listener="#{sluchaczManager.changeSzkolenie}" update="rejOs" oncomplete="PF('dlgRejestracjaOsoby').show();" />
					   		 <f:selectItem />
					         <f:selectItems value="#{sluchaczManager.plutonListSzkolenie}"/>
					    </p:selectOneMenu>
			</h:panelGrid>
			<h:outputLabel>Słuchacz: </h:outputLabel>
			    <p:selectOneMenu value="#{sluchaczManager.imieNazwiskoSluchacza}" lazy="true" style="width:80%" required="true">
			     <p:ajax event="change" listener="#{sluchaczManager.checkSluchacz}" update="rejOs" oncomplete="PF('dlgRejestracjaOsoby').show();" />
					   		 <f:selectItem />
					         <f:selectItems value="#{sluchaczManager.sluchaczeWplutonie}"/>
					    </p:selectOneMenu>
			<h:outputLabel>Login: </h:outputLabel>
				<p:inputText value="#{sluchaczManager.login}" required="true"/>
			<h:outputLabel>Hasło: </h:outputLabel>
				<p:password value="#{sluchaczManager.haslo}" autocomplete="one-time-code" required="true"/>
			<h:outputLabel>Hasło: </h:outputLabel>
				<p:password value="#{sluchaczManager.passRepeat}" autocomplete="one-time-code" required="true"/>
			<h:outputLabel>Status: </h:outputLabel>
				<p:selectOneMenu value="#{sluchaczManager.status}"  required="true">
									<f:selectItem itemLabel="sluchacz" itemValue="sluchacz"/>
			</p:selectOneMenu>
					<h:outputLabel>Poziom uprawnień: </h:outputLabel>
					<p:selectOneMenu value="#{sluchaczManager.poziomUprawnien}">
									<f:selectItem itemLabel="7" itemValue="7"/>
					</p:selectOneMenu>
			<h:outputLabel>Zmiana hasła: </h:outputLabel>
				<p:calendar  value="#{sluchaczManager.zmianaHasla}" pattern="yyyy-MM-dd" locale="pl" required="true"/>
			<h:outputLabel>Blokada: </h:outputLabel>
					<p:selectOneMenu value="#{sluchaczManager.zablokowany}">
									<f:selectItem itemLabel="TAK" itemValue="TAK"/>
									<f:selectItem itemLabel="NIE" itemValue="NIE"/>
					</p:selectOneMenu>
			</h:panelGrid>
				<p:commandButton  action="#{sluchaczManager.addUser}" value="Zapisz" icon="ui-icon-calculator" 
				update=":formUsers,dialogUserStudent" style="float:right;margin:10px"/>
		</h:form>	
		</p:dialog>
	
				
			
	<h:form id="formUsers">
			<p:growl id="msgs" showDetail="true" autoUpdate="true"/>
		<p:dataTable   id="users" var="users" value="#{sluchaczManager.ul}" 
				widgetVar="usersTable" emptyMessage="Brak wyników" 
				class="my-tab-hover"
				editable="true" rowStyleClass="#{users.zablokowany eq 'TAK' ? 'zablokowanyRow' : ''}"  paginator="true" rows="15"
				 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
				  rowsPerPageTemplate="15,20,50,100,150" rowKey="#{users.idUsers}" >
				<f:facet name="header">
				<div style="overflow:auto!important; width:100%;  white-space: nowrap">
						<span style="position:relative;top:5px;display:inline-block">Słuchacze</span>
						<div style="display:inline-block;float:right">
						<h:outputText value="Archiwum: " />
											 <p:selectBooleanButton id="arche" value="#{sluchaczManager.edycjaArch}" onLabel="TAK" offLabel="NIE" style="width:60px;margin-right:50px">
											 		<p:ajax update="users" listener="#{sluchaczManager.changeArche}"/>
											 </p:selectBooleanButton>
								<p:commandButton type="button" icon="ui-icon-calculator" value="Dodaj" style="display:inline-block" onclick="PF('dlgRejestracjaOsoby').show();"/>
								 <p:commandButton id="toggler" type="button" value="Kolumny" style="display:inline-block" icon="fa fa-align-justify" />
				        		<p:columnToggler datasource="users" trigger="toggler" />
		        		</div>
						
				</div>
			<div style="clear:both" ></div>	
				</f:facet>
					<p:column filterBy="#{users.idUsers}"  sortBy="#{users.idUsers}"  headerText="Id u." footerText="Id u."  
							styleClass="columnAlignCenter" style="width:75px">
							<h:outputText value="#{users.idUsers}" />
					</p:column>
					<p:column filterBy="#{users.sluchacze.idS}"  headerText="Id sł." footerText="Id" 
					styleClass="columnAlignCenter" style="width:85px" filterStyle="width:90%;margin:auto" sortBy="#{users.sluchacze.idS}">
						<h:outputText value="#{users.sluchacze.idS}"/>
					</p:column>
					<p:column  filterBy="#{users.sluchacze.nazwiskoSluchacz}" headerText="Nazwisko" footerText="Nazwisko" sortBy="#{users.sluchacze.nazwiskoSluchacz}">
						<h:outputText value="#{users.sluchacze.nazwiskoSluchacz}" />
					</p:column>
					<p:column filterBy="#{users.sluchacze.imieSluchacz}" headerText="Imię" footerText="Imię" 
					sortBy="#{users.sluchacze.imieSluchacz}">
						<h:outputText value="#{users.sluchacze.imieSluchacz}" />
					</p:column>
					<p:column filterBy="#{users.loginUsers}" filterValue="#{sluchaczManager.filterValues['users.loginUsers']}" headerText="Login" footerText="Login" 
					sortBy="#{users.loginUsers}" styleClass="columnAlignCenter">
								<h:outputText value="#{users.loginUsers}" />
					</p:column>
					<p:column filterBy="#{users.kompania}" headerText="Komp." footerText="Komp." styleClass="columnAlignCenter" 
					sortBy="#{users.kompania}">
							<h:outputText value="#{users.kompania}" />
					</p:column>
					<p:column filterBy="#{users.pluton}" sortBy="#{users.pluton}" headerText="Plut." footerText="Plut." 
					styleClass="columnAlignCenter">
							<h:outputText value="#{users.pluton}" />
					</p:column>
					<p:column filterBy="#{users.szkolenie}" sortBy="#{users.szkolenie}" headerText="Szkol." footerText="Szkol." 
					styleClass="columnAlignCenter">
							<h:outputText value="#{users.szkolenie}" />
					</p:column>
					<p:column sortBy="#{users.ostatnieLogowanie}" headerText="Ostatnie log." footerText="Ostatnie log." 
						styleClass="columnAlignCenter" filterStyle="width:90%;margin:auto" filterMatchMode="contains">
						<h:outputText value="#{users.ostatnieLogowanie}" />
					</p:column>
					<p:column sortBy="#{users.zmianaHasla}"  headerText="Zmiana hasła" footerText="Zmiana hasła"  styleClass="columnAlignCenter" 
					filterStyle="width:90%;margin:auto" filterMatchMode="contains">
							<h:outputText value="#{users.zmianaHasla}" >
								<f:convertDateTime pattern="yyyy-MM-dd"/>
							</h:outputText>
					</p:column>
					<p:column filterBy="#{users.zablokowany}"  filterValue="#{sluchaczManager.filterValues['users.zablokowany']}" sortBy="#{users.zablokowany}" 
						 headerText="Blok." footerText="Blok."  styleClass="columnAlignCenter"  filterStyle="width:90%;margin:auto">
						<h:outputText value="#{users.zablokowany}" />
							
					</p:column>
					 <p:column sortBy="#{users.errLog}"  headerText="B.h" footerText="B.h"  styleClass="columnAlignCenter" style="width:65px" 
					 filterStyle="width:90%;margin:auto" filterMatchMode="contains">
							<h:outputText value="#{users.errLog}" />
					</p:column>
		  			<p:column style="width:65px;text-align: center" headerText="Akcja" footerText="Akcja">
            	 <p:commandButton update=":formUsersDetail:userDetail" actionListener="#{sluchaczManager.rowSelectedUser(users)}" 
           					  oncomplete="PF('userDialog').show()" icon="fa fa-search" title="View" />
       			 </p:column>
        
        	<p:column style="width:35px" headerText="Usuń" footerText="Usuń" >
						<p:commandButton icon="fa fa-cut" class="buttDelete" disabled="#{users.zablokowany!='TAK'}"  actionListener="#{sluchaczManager.del}" update="@form">
							<f:attribute name="removeRow" value="#{users}" />
							<p:confirm  header=" Uwaga, próbujesz usunąć konto!" message=" Czy potwierdzasz? " /> 
						</p:commandButton>
					</p:column>
         
	  </p:dataTable>
	</h:form>
	
	
	
<p:dialog  header="Uzytkownik" id="usDial" widgetVar="userDialog" modal="true" appendTo="@(body)" showEffect="fade" hideEffect="fade" resizable="false">
<p:ajax event="close" update="usDial" resetValues="true" />
    <h:form id="formUsersDetail">	
          
        <p:outputPanel id="userDetail" >
            <p:panelGrid  columns="6" rendered="#{not empty sluchaczManager.selectedUser}">
                <f:facet name="header" >
                <div style="float:left">
                   <span class="fa fa-user" style="font-size:25px;color:gray"></span>
                   <h:outputText value=" Id: #{sluchaczManager.selectedUser.idUsers}, #{sluchaczManager.selectedUser.sluchacze.nazwiskoSluchacz} #{sluchaczManager.selectedUser.sluchacze.imieSluchacz}" />
                   </div>
                </f:facet>        
                <h:outputText value="Kompania:" />
                <h:outputText value="#{sluchaczManager.selectedUser.kompania}" style="font-weight:bold"/>
				<h:outputText value="Pluton:" />
				<h:outputText value="#{sluchaczManager.selectedUser.pluton}" style="font-weight:bold"/>
				<h:outputText value="Szkolenie:" />
				<h:outputText value="#{sluchaczManager.selectedUser.szkolenie}" style="font-weight:bold"/>
				<h:outputText value="Login:" />               
                 <p:inputText value="#{sluchaczManager.selectedUser.loginUsers}" required="true"/>
                 <h:outputText value="Hasło:" />
                 <p:outputPanel>
                 <p:password value="#{sluchaczManager.haslo}" autocomplete="one-time-code" label="Haslo" /><br />
				<p:password value="#{sluchaczManager.passRepeat}" autocomplete="one-time-code" label="Powtorzone haslo" style="margin-top:5px"/>
                 </p:outputPanel>
          
		    <h:outputText value="Zmiana hasła:" />		
		     <p:calendar id="zmianaHasla" value="#{sluchaczManager.selectedUser.zmianaHasla}" pattern="yyyy-MM-dd" locale="pl"/>	
		      <h:outputText value="Zablokowany:" />	
		     <p:selectOneMenu value="#{sluchaczManager.selectedUser.zablokowany}" >
									<f:selectItem itemLabel="TAK" itemValue="TAK"/>
									<f:selectItem itemLabel="NIE" itemValue="NIE"/>
			</p:selectOneMenu>
			<h:outputText value="Błędne logowania:" />	
			<p:inputText value="#{sluchaczManager.selectedUser.errLog}" style="width:40%!important" required="true"/>		
			<h:outputText value="" />	
			<h:outputText value="" />						
            </p:panelGrid>
            <p:commandButton value="zapisz" update=":formUsers, formUsersDetail" actionListener="#{sluchaczManager.onRowEdit}"  icon="fa fa-save" 
            style="margin:10px 0 10px 0; width:100%"/>
            
        </p:outputPanel>
        </h:form>
 </p:dialog>
			</h:panelGroup>
			
			
			
			
			
		</ui:define>
	
	<ui:define name="footer">
	</ui:define>
</ui:composition>






	




