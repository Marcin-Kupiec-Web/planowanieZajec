<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/templates/BasicTemplate.html">
	
	<ui:define name="leftPane"></ui:define>
		<ui:define name="subMenuCont"><ui:include src="/WEB-INF/templates/zajecia/submenuZajecia.html"/></ui:define>
		<ui:define name="grupaSzkol"><ui:include src="/WEB-INF/templates/zajecia/plutonWybor.html"/></ui:define>
		<ui:define name="akcja">
				<p:ajax event="change" listener="#{tematyServ.init}" update="contentOutputPanel"/>
		</ui:define>
		
<ui:define name="content"> 
<p:outputPanel deferred="true" id="contentOutputPanel">
<p:panel id="contentTrescZajecia">
		<h:form id="formTematy" >
		<p:growl id="msgs" showDetail="false"/>
			<p:dataTable id="dtTematy" var="temat" value="#{tematyServ.tematyWplutonieSort}"  editable="true" editMode="cell"   
			 selection="#{tematyServ.selectedTemats}" rowKey="#{temat.tematyGdzl}" widgetVar="cellTematy" 
				style="text-align:center; width:100%"  resizableColumns="false" class="my-table my-editable shadow"  
				rendered="#{wyborPlutonu.idPlutonWybrany>0}" reflow="true">
				<f:facet name="header">
		 
						<p:outputPanel  id="dataSubMenu" style="font-size:smaller;overflow:auto;text-align:left">
						<nobr>
									<p:selectBooleanButton id="edit" class="shadow" style="width:50px" value="#{tematyServ.editTem}" 
															onIcon="fa fa-lock-open" offIcon="fa fa-lock" 
															rendered="#{logowanie.poziomUprawnien le 4}">
        					 								<p:ajax update=":formTematy" />
        					 		</p:selectBooleanButton>
        					 		<p:commandButton process="dtTematy"  rendered="#{tematyServ.editTem}" update=":formTematy:multiTematDialog" 
													  icon="fa fa-edit" class="active shadow" value="Dodaj"  title="Zaznacz godzinę/y i wpisz nowy temat" 
													  oncomplete="PF('multiTematDialog').show()" action="#{tematyServ.createInit()}"/>
									<p:commandButton class="shadow" icon="ui-icon-circle-arrow-w" action="#{tematyServ.init}" style="margin-right:4px;margin-left:10px"
													update="dataSubMenu,contentOutputPanel" process="@this">
											<f:setPropertyActionListener value="prev" target="#{wyborPlutonu.move}"></f:setPropertyActionListener>
									</p:commandButton>
									<p:calendar value="#{wyborPlutonu.dataFormGlowny}" locale="pl"  styleClass="calendar shadow" size="10" pattern="dd-MM-yyyy" effect="fade" >
											<p:ajax event="dateSelect" listener="#{tematyServ.init}" update="dataSubMenu,contentTrescZajecia" />
											<p:ajax event="change" listener="#{wyborPlutonu.changeSzkolenie}" update="dataSubMenu,contentOutputPanel" process="@this"/>
									</p:calendar>
									<p:commandButton class="shadow" icon="ui-icon-home" action="#{tematyServ.init}" update="dataSubMenu,contentOutputPanel" 
														process="@this" style="margin-left:4px;margin-right:4px">
											<f:setPropertyActionListener value="today" target="#{wyborPlutonu.move}"></f:setPropertyActionListener>
									</p:commandButton>
									<p:commandButton class="shadow" icon="ui-icon-circle-arrow-e" action="#{tematyServ.init}" update="dataSubMenu,contentOutputPanel" process="@this">
											<f:setPropertyActionListener value="next" target="#{wyborPlutonu.move}"></f:setPropertyActionListener>
									</p:commandButton>	
						</nobr>								
							</p:outputPanel>
			</f:facet>
			<f:facet name="footer">
						<div style="float:left;margin:left:20px;opacity:0.9">Zrealizowano: #{tematyServ.tematyWplutonie.size()} godz.</div>
						<p:selectBooleanButton id="wiecejMniej" class="shadow"  value="#{tematyServ.moreTable}" onLabel="-" offLabel="+"
        												rendered="#{logowanie.poziomUprawnien!='7'}" style="float:right">		
        									 <p:ajax listener="#{tematyServ.addMessage}" update=":formTematy" />
        					 		</p:selectBooleanButton>
						<div style="clear:both"></div>
			</f:facet>
				<p:ajax event="cellEdit"  listener="#{tematyServ.onCellEdit(temat)}" update=":formTematy:msgs,:formTematy:dtTematy"  />
			<p:column selectionMode="multiple"  rendered="#{temat.JM_tematy==null and tematyServ.editTem}" style="text-align:center;width:50px"/>
			<p:column rendered="#{temat.JM_tematy!=null and tematyServ.editTem}"/>
			<p:column headerText="G.l." footerText="G.l." style="width:50px">
						<h:outputText value="#{temat.tematyGdzl}" />
			</p:column>
			<p:column headerText="Id" footerText="Id"  rendered="#{logowanie.poziomUprawnien eq 1 and (tematyServ.moreTable)}">
						<h:outputText value="#{temat.idTematy}" rendered="#{temat.idTematy!=0}"/>
			</p:column>
			<p:column headerText="#{wyborPlutonu.jmpw}" footerText="#{wyborPlutonu.jmpw}" id="jmjskpn" >
						<h:outputText value="#{temat.JM_tematy}" />							
			</p:column>
			<p:column  headerText="#{wyborPlutonu.jspw}" footerText="#{wyborPlutonu.jspw}" rendered="#{wyborPlutonu.jspw!=null}" >
						<h:outputText value="#{temat.JS_tematy}" />
			</p:column>
			<p:column  headerText="#{wyborPlutonu.kpnpw}" footerText="#{wyborPlutonu.kpnpw}">
							<h:outputText value="#{temat.KPN_tematy}"/>							
			</p:column>
			<p:column headerText="Zreal." footerText="Zreal." styleClass="preformated" >
							<h:outputText value="#{temat.ktoZrealizowal}" />
			</p:column>
			<p:column headerText="Rejestr." rendered="#{tematyServ.moreTable}" footerText="Rejestr." styleClass="preformated" >
							<h:outputText value="#{temat.ktoWpisal}" />
			</p:column>
			<p:column headerText="Ob" footerText="Ob" rendered="#{tematyServ.moreTable}">						
							<h:outputText value="#{temat.idTematy!=0?tematyServ.wszyscySluchacze-(tematyServ.frekwencjaWdniu.stream().filter(fl->fl.godzinaLekcyjna==temat.tematyGdzl and (!fl.wartosc.equals('Sp'))).count()):''}"  />
			</p:column>
			<p:column headerText="Nb" footerText="Nb" rendered="#{tematyServ.moreTable}">
							<h:outputText value="#{temat.idTematy!=0?tematyServ.frekwencjaWdniu.stream().filter(fl->fl.godzinaLekcyjna==temat.tematyGdzl and (!fl.wartosc.equals('Sp'))).count():''}"  />
			</p:column>
			<p:column style="padding:0px" rendered="#{tematyServ.tematyWplutonieSort.stream().filter(tem->tem.idWpisal==logowanie.idUsers).count()>0  and tematyServ.editTem}">
							<f:facet name="header"><i  class="fa fa-toolbox"></i></f:facet>
							<f:facet name="footer"><i  class="fa fa-toolbox"></i></f:facet>
						<p:commandButton update=":formTematy:tematDialog" process="@this"  oncomplete="PF('tematDialog').show()"
						class="hadow" icon="fa fa-search" title="Popraw" style="width:70px"
						rendered="#{temat.idTematy!=0 and temat.idWpisal==logowanie.idUsers}" action="#{tematyServ.updateInit(temat)}" >
                		<!-- <f:setPropertyActionListener value="#{temat}" target="#{tematyServ.tematySelect}" />-->
          			  </p:commandButton> 
			</p:column>
	</p:dataTable> 
		
	<p:confirmDialog global="true" showEffect="fade" hideEffect="fade" styleClass="my-dialog">
        <p:commandButton value="Tak" type="button" styleClass="ui-confirmdialog-yes bg-danger" icon="fa fa-check" />
        <p:commandButton value="Nie" type="button" styleClass="ui-confirmdialog-no bg-primary" icon="fa fa-times" />
    </p:confirmDialog>   
    
			<p:dialog widgetVar="multiTematDialog" id="multiTematDialog" modal="true" showEffect="fade" hideEffect="fade" resizable="true" 
			styleClass="my-dialog">
				<p:ajax event="close" update="multiTematDialog" resetValues="true" />
					<f:facet name="header">Kreator tematów 
					<h:outputText value="#{tematyServ.dataFormGlowny}">
								<f:convertDateTime  type="date" pattern="dd/MMM./yyyy"/>
					</h:outputText>
					
					</f:facet>
				        <p:outputPanel id="multiTematDetail" style="text-align:left;"  rendered="#{tematyServ.selectedTemats.size()>0}">
				         <div  class="shadow m-10" style="background:whitesmoke;display:inline-block;padding:2px 15px 2px 15px;color:gray;font-weight:bold;max-width:90%">
				        <h:outputText value="Godziny lekcyjne: "/>
				            <ui:repeat value="#{tematyServ.selectedTemats}" var="temat" varStatus="status">
				                <h:outputText value="#{temat.tematyGdzl}" style="display:inline-block"/>
				                <h:outputText value=", " rendered="#{!status.last}" />
				            </ui:repeat>
				            </div>
				            <p:outputPanel deferred="false" id="jmjskpn">		
								<div class="ui-fluid">
									    <div class="ui-g">
		                						<div class="ui-g-4 ui-sm-12">
		                							<p:selectOneMenu value="#{tematyServ.jmWybrana}" id="somJm" panelStyle="min-width:70px" style="width:100%!important;margin-top:1px" required="true">
									 					<p:ajax event="change" listener="#{tematyServ.listJm(null)}" update="jmjskpn" />
									 					<f:selectItem />
														 <f:selectItems value="#{tematyServ.jm}"/>
													</p:selectOneMenu>
		                						</div>
		                						<div class="ui-g-4 ui-sm-12">
		                								<p:selectOneMenu id="somJs" value="#{tematyServ.jsWybrana}" style="width:100%!important;margin-top:1px" panelStyle="min-width:70px" required="true">
								 							<p:ajax event="change" listener="#{tematyServ.listJs(null)}" update="jmjskpn" />
															 <f:selectItem />
															 <f:selectItems value="#{tematyServ.js}"/>
														</p:selectOneMenu>
		                						</div>
		                						<div class="ui-g-4  ui-sm-12">
		                								<p:selectOneMenu id="somKpn"  value="#{tematyServ.kpnWybrany}" editable="true" filter="true" filterMatchMode="contains" required="true" style="margin-top:1px;width:100%!important">
															 <f:selectItems value="#{tematyServ.kpn}" />
														</p:selectOneMenu>	
		                						</div>
		                						<div class="ui-g-12">
		                									<p:autoComplete multiple="true"  completeMethod="#{tematyServ.completeAreaUs}" style="width:99%"
													value="#{tematyServ.usersAutocompleteMulti}" scrollHeight="300"  required="true"/>	
												</div>
		                						<div class="ui-g-12">
				                						<p:commandButton id="btn_add" class="shadow" style="width:100%;padding:5px;margin-top:10px" value="Zapisz" 
						          										 update="formTematy" process="multiTematDetail" action="#{tematyServ.createNew()}" 
						        						   				oncomplete="if (args &amp;&amp; args.validationFailed) PF('multiTematDialog').show()">
				        						  		 </p:commandButton>
				        						  </div>
						  			
		                				</div>
									</div>
								</p:outputPanel>									
				        </p:outputPanel>
				        <p:outputPanel rendered="#{tematyServ.selectedTemats.size()==0}">
				        	<div class="shadow m-10 bg-danger-light" style="padding:30px;font-weight:bold;color:white;border-radius:5px">
				        		Nie wybrano godziny/n!
				        	</div>
				        </p:outputPanel>
				           
				   </p:dialog>
				   
				  <p:dialog widgetVar="tematDialog" id="tematDialog" modal="true" showEffect="fade" hideEffect="fade" resizable="false" 
				  			styleClass="my-dialog">
				  	<p:ajax event="close" update="tematDialog" resetValues="true" />
					<f:facet name="header">Edycja tematu 
					<h:outputText value="#{tematyServ.dataFormGlowny}">
								<f:convertDateTime  type="date" pattern="dd/MMM./yyyy"/>
					</h:outputText>
					
					</f:facet>
				        <p:outputPanel id="jmjskpntd" style="text-align:left">
										<div class="ui-fluid">
									    <div class="ui-g">
		                						<div class="ui-g-4 ui-sm-12">
		                								<p:selectOneMenu value="#{tematyServ.tematySelect.JM_tematy}" id="somJmtd" panelStyle="width:20%" style="width:100%!important;margin-top:1px" required="true">
															 <p:ajax event="change" listener="#{tematyServ.listJm(tematyServ.tematySelect)}" update="jmjskpntd" />
									 						<f:selectItem />
															 <f:selectItems value="#{tematyServ.jm}"/>
														</p:selectOneMenu>
		                						</div>
		                						<div class="ui-g-4 ui-sm-12">
		                									<p:selectOneMenu id="somJstd" value="#{tematyServ.tematySelect.JS_tematy}" style="width:100%!important;margin-top:1px" panelStyle="width:50px" required="true">
																 <p:ajax event="change" listener="#{tematyServ.listJs(tematyServ.tematySelect)}" update="jmjskpntd" />
																 <f:selectItem />
																 <f:selectItems value="#{tematyServ.js}"/>
															</p:selectOneMenu>
		                						</div>
		                						<div class="ui-g-4  ui-sm-12">
		                									<p:selectOneMenu id="somKpntd"  value="#{tematyServ.tematySelect.KPN_tematy}" editable="true" filter="true" filterMatchMode="contains" required="true" 
		                													style="width:100%!important;margin-top:1px">
										 						 <p:ajax event="change" listener="#{tematyServ.changeKPN(tematyServ.tematySelect)}" update="jmjskpntd" />
																 <f:selectItems value="#{tematyServ.kpn}" />
															</p:selectOneMenu>
		                						</div>		                						
		                						<div class="ui-g-12">
		                							<p:autoComplete  completeMethod="#{tematyServ.completeAreaUs}" queryDelay="200" minQueryLength="1" style="width:99%!important"
																	value="#{tematyServ.usersAutocompleteMulti}" scrollHeight="300" 	multiple="true" required="true"/>
		                						</div>
		                						<div class="ui-g-12">
		                									<p:commandButton icon="fa fa-eraser" id="butRem"  class="bg-danger shadow"
																			process="@this"   actionListener="#{tematyServ.removeRow}"  
																			update=":formTematy:dtTematy"  
																			rendered="#{tematyServ.tematySelect.zrealizowaneCzas!=null and (logowanie.poziomUprawnien eq 1 or (tematyServ.tematySelect.idWpisal==logowanie.idUsers))}" 
																			style="width:18%;float:left;padding:5px" oncomplete="PF('tematDialog').hide()"> 
																	<f:attribute name="removeRow" value="#{tematyServ.tematySelect}" />
																	<p:confirm  header=" Uwaga, próbujesz usunąć temat!" message=" Czy potwierdzasz? " /> 
															</p:commandButton>
						
															<p:commandButton id="btn_adds" class="shadow" style="width:80%;float:right;padding:5px" value="Zapisz" 
				       													    update="formTematy" process="@this,jmjskpntd" action="#{tematyServ.onCellEdit(tematyServ.tematySelect)}" 
				      													     oncomplete="if (args &amp;&amp; args.validationFailed) PF('tematDialog').show()">
						            
														   </p:commandButton>
		                						</div>
		                				</div>
									</div>
						
				        </p:outputPanel>
				           
				   </p:dialog>
	</h:form>								
 </p:panel>
 </p:outputPanel>
 </ui:define>
<ui:define name="footer"></ui:define>
</ui:composition>