<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/templates/BasicTemplate.html">
	
		<ui:define name="subMenuCont"><ui:include src="/WEB-INF/templates/zajecia/submenuZajecia.html"/></ui:define>
		<ui:define name="grupaSzkol"><ui:include src="/WEB-INF/templates/zajecia/plutonWybor.html"/></ui:define>
		<ui:define name="akcja">
				<p:ajax event="change" listener="#{frekwencja.init}" update="contentOutputPanel"/>
		</ui:define>
	<ui:define name="content"> 
	
		<p:outputPanel deferred="true" id="contentOutputPanel">
				<p:panel id="contentTrescZajecia" rendered="#{logowanie.poziomUprawnien le 4}"> 
				
				  <h:form id="obecnoscPanelGridForm" rendered="#{wyborPlutonu.idPlutonWybrany>0}"  style="overflow:auto" >
				   <p:growl id="msgs"/>
				       			<p:panelGrid style="margin:auto" id="obecnoscPanelGrid" styleClass="obecnoscPanelGrid" class="shadow my-table-strip my-table-hov" >
				       				<f:facet name="header">
				       					<p:row styleClass="gridThObecnosc">
				       						<p:column colspan="#{frekwencja.andHour+3}" style="text-align:left">
								       					<h:panelGrid  columns="4"  style="display:inline-block" >
								       						<p:selectBooleanButton id="edit" class="shadow  btn-sm" value="#{frekwencja.editFrek}" onIcon="fa fa-lock-open" offIcon="fa fa-lock"
					       												rendered="#{logowanie.poziomUprawnien le 4}" style="width:50px;font-size:smaller">
					        					 							<p:ajax update="obecnoscPanelGridForm"/>
					        									 </p:selectBooleanButton>
									       						<p:selectBooleanButton value="#{frekwencja.laczRozlacz}"
									       						onIcon="ui-icon-extlink" offIcon="ui-icon-newwin" rendered="false"
									       						class="shadow  btn-sm">
									       							<p:ajax update="msgs" listener="#{frekwencja.addMessageChangeLacz}"/>
									       						</p:selectBooleanButton>
									       							<p:commandButton icon="fa fa-undo" type="reset" class="resetButton shadow  btn-sm" rendered="#{frekwencja.editFrek}">
									       								<p:ajax event="click" listener="#{frekwencja.resetObecnosc}" update="obecnoscPanelGridForm"/>
									       							</p:commandButton>
									       							
									       							<p:commandButton id="btnAnsHead" class="shadow  btn-sm" icon="fa fa-save" action="#{frekwencja.init()}" update="obecnoscPanelGridForm" 
									       											 rendered="#{frekwencja.editFrek}"/>									       					
								       						</h:panelGrid>
															 <h:panelGrid columns="4" id="dataSubMenu" styleClass="subMenuCont" style="display:inline-block;font-size:smaller">
																			<p:commandButton icon="ui-icon-circle-arrow-w" action="#{frekwencja.init}" update="dataSubMenu,contentOutputPanel" style="margin-left:10px" >
																				<f:setPropertyActionListener value="prev" target="#{wyborPlutonu.move}"></f:setPropertyActionListener>
																			</p:commandButton>
																			<p:calendar value="#{wyborPlutonu.dataFormGlowny}" locale="pl"  styleClass="calendar" size="10" pattern="dd-MMM-yyyy" effect="fade" >
																				<p:ajax event="dateSelect" listener="#{frekwencja.init}" update="dataSubMenu,contentTrescZajecia" />
																				<p:ajax event="change" listener="#{wyborPlutonu.changeSzkolenie}" update="dataSubMenu,contentOutputPanel" />
																			</p:calendar>
																			<p:commandButton icon="ui-icon-home" action="#{frekwencja.init}" update="dataSubMenu,contentOutputPanel">
																				<f:setPropertyActionListener value="today" target="#{wyborPlutonu.move}"></f:setPropertyActionListener>
																			</p:commandButton>
																			<p:commandButton icon="ui-icon-circle-arrow-e" action="#{frekwencja.init}" update="dataSubMenu,contentOutputPanel">
																				<f:setPropertyActionListener value="next" target="#{wyborPlutonu.move}"></f:setPropertyActionListener>
																			</p:commandButton>
																</h:panelGrid>				       					
				       						</p:column>
				       					</p:row>
				       					<p:row style="text-align:center" styleClass="gridThObecnosc">
				       						<p:column style="width:20px">Nr.dz.</p:column>
				       						<p:column style="white-space:nowrap;width:35%">Nazwisko, imię</p:column>
				       							<c:forEach var="i" begin="1" end="#{frekwencja.andHour}">
														<p:column >
														  <h:panelGrid columns="2" style="padding:0px;margin:auto" class="checkObTh checkObTh${i}" id="g${i}">
															<h:outputLabel value="${i} " style="margin-right:2px"/>
															  <p:triStateCheckbox disabled="#{!frekwencja.editFrek}" rendered="#{logowanie.poziomUprawnien le 4}" value="#{frekwencja.checkObecnoscTh}" valueChangeListener="#{frekwencja.onObecnoscUpdate}" >
																		<f:attribute name="godzina" value="${i}"/>
															  </p:triStateCheckbox>
														
														</h:panelGrid>
														</p:column>
												</c:forEach>
				       					</p:row>
				       				</f:facet>
				       			 <f:facet name="footer" >
				       					<p:row style="text-align:center;height:40px" styleClass="gridThObecnosc" rendered="#{logowanie.poziomUprawnien le 4}">
				       			
				       					<p:column colspan="#{frekwencja.andHour+2}">
				       							<p:commandButton icon="fa fa-plus" class="shadow  btn-sm" 
				       							style="background:whitesmoke;color:lightgray;width:40px!important;height:22px;float:right;border:1px solid lightgray" 
					       											  rendered="#{frekwencja.editFrek}">
					       								<p:ajax event="click" listener="#{frekwencja.changeHoursPlus}" update="obecnoscPanelGridForm"/>
					       						</p:commandButton>
					       						<p:commandButton icon="fa fa-minus" class="shadow  btn-sm" 
					       						style="background:whitesmoke;color:lightgray;width:40px!important;height:22px;float:right;border:1px solid lightgray" 
					       											  rendered="#{frekwencja.editFrek}">
					       								<p:ajax event="click" listener="#{frekwencja.changeHoursMinus}" update="obecnoscPanelGridForm"/>
					       						</p:commandButton>
				       						<h:panelGrid  columns="2"  style="color:gray;float:left" cellspacing="0px" cellpadding="0px">
						       							<p:commandButton icon="fa fa-undo" type="reset" class="resetButton shadow btn-sm" style="margin:0 10px 0 10px" 
						       											  rendered="#{frekwencja.editFrek}">
						       								<p:ajax event="click" listener="#{frekwencja.resetObecnosc}" update="obecnoscPanelGridForm"/>
						       							</p:commandButton>
						       							<p:commandButton id="btnAns" class="shadow  btn-sm" icon="fa fa-save" action="#{frekwencja.init()}" update="obecnoscPanelGridForm" 
						       											 rendered="#{frekwencja.editFrek}"/>
						       					
				       						</h:panelGrid>
				       					</p:column>
				       					
				       					</p:row>
				       				</f:facet>
				       				<ui:repeat var="listaSluchaczy" value="#{frekwencja.sluchaczeSorted}">
				       							<p:row>
				       									<p:column style="text-align:center" class="#{listaSluchaczy.usuniety=='TAK'?'usunietyRow' : ''}">
															${listaSluchaczy.nrDziennik}
														</p:column>
														<p:column style=";color:#606060;font-weight:bold;text-decoration:#{listaSluchaczy.usuniety=='TAK'?'line-through':''}" class="#{listaSluchaczy.usuniety=='TAK'?'usunietyRow' : ''}">
															 ${listaSluchaczy.nazwiskoSluchacz} ${listaSluchaczy.imieSluchacz}
														</p:column>
												<c:forEach var="i" begin="1" end="#{frekwencja.andHour}">
													<p:column style="text-align:center;height:30px;padding:0px" class="sel_ect selColg#{i} #{listaSluchaczy.usuniety=='TAK'?'usunietyRow' : ''}" >
														<div class="${listaSluchaczy.idS}" style="width:100%">
															<ui:fragment rendered="#{listaSluchaczy.obecnoscs.stream().count()>0}" >
															
																			 <ui:fragment rendered="#{listaSluchaczy.obecnoscs.stream().filter(obecn->obecn.godzinaLekcyjna==i).count()>0 }">
																			 
																						<ui:repeat var="obecnosc" value="#{listaSluchaczy.obecnoscs.stream().filter(obecn->obecn.godzinaLekcyjna==i).toList()}" >
																						
																								<ui:fragment rendered="#{obecnosc.usunieta=='TAK' and frekwencja.editFrek}">
																								<div style="min-width:20px; white-space: nowrap;">
																										<h:selectOneMenu for="obRem" rendered="#{(listaSluchaczy.usuniety eq 'NIE') and (logowanie.poziomUprawnien le 4)}" styleClass="renderInput" value="#{frekwencja.wyborObecnosc}" valueChangeListener="#{frekwencja.onObecnoscUpdate}" >
																								 				<f:attribute name="action" value="${obecnosc}"/>
																								  		    	 <f:selectItems value="#{frekwencja.wyborObecnoscList}"/>
															   											 </h:selectOneMenu>
															   									</div>
																							    </ui:fragment>
																								<ui:fragment rendered="#{obecnosc.usunieta=='NIE'}">
																											<p:outputLabel id="ob" class="#{frekwencja.editFrek?'renderText':''} #{obecnosc.classObNb}" value="${obecnosc.wartosc}" />
																											<p:tooltip for="ob" position="top" >
																												<h:outputText value="#{obecnosc.imieNazwiskoUser} "/><br />
																												<h:outputText value="#{obecnosc.dataWpisu}">
																												<f:convertDateTime pattern="dd-MMM-yyyy HH:mm" type="date" locale="pl"/>
																												</h:outputText>
																										</p:tooltip>
																											<ui:fragment rendered="#{frekwencja.wyborObecnoscList[obecnosc.wartosc]==null }">
																												 <h:selectOneMenu rendered="#{(listaSluchaczy.usuniety eq 'NIE') and (logowanie.poziomUprawnien le 4) and frekwencja.editFrek}" styleClass="renderInput" value="#{obecnosc.wartosc}" valueChangeListener="#{frekwencja.onObecnoscUpdate}" >
																													<f:attribute name="action" value="#{obecnosc}"/>
																												         <f:selectItems value="#{frekwencja.wyborObecnoscList}"/>
																												         <f:selectItem itemValue="#{obecnosc.wartosc}" itemLabel="#{obecnosc.wartosc}"/>
																	   										 	</h:selectOneMenu>
																	   									 </ui:fragment>
																	   									 	<ui:fragment rendered="#{frekwencja.wyborObecnoscList[obecnosc.wartosc]!=null and frekwencja.editFrek}">
																												 <h:selectOneMenu rendered="#{(listaSluchaczy.usuniety eq 'NIE') and (logowanie.poziomUprawnien le 4)}" styleClass="renderInput" value="#{obecnosc.wartosc}" valueChangeListener="#{frekwencja.onObecnoscUpdate}" >
																													<f:attribute name="action" value="#{obecnosc}"/>
																												         <f:selectItems value="#{frekwencja.wyborObecnoscList}"/>
																	   										 	</h:selectOneMenu>
																	   									 </ui:fragment>
																								</ui:fragment>
																						</ui:repeat>
																					<c:set var="loop" value="stop"/>
																			 </ui:fragment>
																
																 <ui:fragment rendered="#{listaSluchaczy.obecnoscs.stream().filter(obecn->obecn.godzinaLekcyjna==i).count()==0}">
																		 	<h:selectOneMenu rendered="#{(listaSluchaczy.usuniety eq 'NIE') and (logowanie.poziomUprawnien le 4) and frekwencja.editFrek}" styleClass="renderInput" value="#{frekwencja.wyborObecnosc}" valueChangeListener="#{frekwencja.onObecnoscSave}" >
																		 				<f:attribute name="obecnoscGodzL" value="${i}"/>
																						<f:attribute name="sluchaczeObject" value="${listaSluchaczy}"/>
																		  		    	<f:selectItems value="#{frekwencja.wyborObecnoscList}"/>
											   								 </h:selectOneMenu>
																</ui:fragment>
															</ui:fragment>
															<ui:fragment rendered="#{listaSluchaczy.obecnoscs.stream().count()==0}" >
																		 	<h:selectOneMenu rendered="#{(listaSluchaczy.usuniety eq 'NIE') and (logowanie.poziomUprawnien le 4) and frekwencja.editFrek}" styleClass="renderInput" value="#{frekwencja.wyborObecnosc}" valueChangeListener="#{frekwencja.onObecnoscSave}" >
																		 				<f:attribute name="obecnoscGodzL" value="${i}"/>
																						<f:attribute name="sluchaczeObject" value="${listaSluchaczy}"/>
																		  		    	 <f:selectItems value="#{frekwencja.wyborObecnoscList}"/>
											   								 </h:selectOneMenu>
															</ui:fragment>
														</div>
													 </p:column> 
												</c:forEach>			
				       							</p:row>
								</ui:repeat>  	
				       	</p:panelGrid>
				 
									<ui:fragment rendered="#{logowanie.poziomUprawnien le 4}">
									<h:outputScript library="js" name="obecnosc/selectAble.js?3" />
									</ui:fragment>
									<p:blockUI block="obecnoscPanelGrid" trigger="btnAnsHead" />   
									<p:blockUI block="obecnoscPanelGrid" trigger="btnAns" />   
				       	</h:form>

							
				 </p:panel>
	<p:panel header="Frekwencja" id="contentTrescZajeciaSluchacz" rendered="#{logowanie.poziomUprawnien eq '7'}" style="width:98%;margin:auto;margin-top:10px"> 
	<!-- ponizej tylko dla słuchaczy -->
	
	<h:form id="form">
		<p:dataTable id="sluchaczeObecnoscLista" var="sluchaczeObecnosc" value="#{frekwencjaLista.sluchaczeSortedOb}" emptyMessage="Brak wyników" 
		class="obecnoscListTable" 
		rowKey="#{sluchaczeObecnosc.idS}" rowExpandMode="single" expandedRow="#{sluchaczeObecnosc.idS==logowanie.sluchacz.idS}" >
					
				<p:column style="width:17px;text-align:center" >
					<p:rowToggler  />
				</p:column>
				<p:column style="text-align:center">
					<f:facet name="header">Nieuspr.</f:facet>
						<h:outputText value="#{sluchaczeObecnosc.obecnoscs.stream().filter(obecn->obecn.wartosc.equals('N')).count()}" style="font-size:larger;color:red" id="nup"/>
				</p:column>
				<p:column style="text-align:center">
					<f:facet name="header">Uspr.</f:facet>
						<h:outputText value="#{sluchaczeObecnosc.obecnoscs.stream().filter(obecn->(!obecn.wartosc.equals('N')) and (!obecn.wartosc.equals('Sp'))).count()}" style="font-size:larger;color:gray" id="uup"/>
				</p:column>
				<p:column  style="text-align:center">
					<f:facet name="header">Spóź.</f:facet>
						<h:outputText value="#{sluchaczeObecnosc.obecnoscs.stream().filter(obecn->obecn.wartosc.equals('Sp')).count()}" style="font-size:larger;color:green" id="sup"/>
				</p:column>
				<p:rowExpansion > 
				
					<p:dataTable id="dtObNb" widgetVar="dataTableWidget" var="obecnosc" value="#{sluchaczeObecnosc.obecnoscs}" 
						 rowKey="#{obecnosc.idObecnosc}" emptyMessage="Brak wyników" rowStyleClass="#{obecnosc.wartosc eq 'N'?'classNbRow':''}"
						styleClass="tableObecnoscList" paginator="true" rows="10"  reflow="true"
						paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} #{sluchaczeObecnosc.obecnoscs.stream().count()==0?'':'{saveOb}'}" 
						rowsPerPageTemplate="10,20,50,100,150">
						<p:ajax event="sort" update="@([id$=filtrCheck])"/>
						<f:facet name="header">#{sluchaczeObecnosc.nazwiskoSluchacz} #{sluchaczeObecnosc.imieSluchacz}: Nieobecności (#{sluchaczeObecnosc.obecnoscs.stream().count()})
						 </f:facet>
											   <p:column  filterBy="#{obecnosc.wartosc}" sortBy="#{obecnosc.wartosc}"  filterValue="#{frekwencjaLista.filterValues['obecnosc.wartosc']}" 
											 headerText="Wpis" filterMatchMode="contains" style="font-weight:bold;color:darkblue">
													<h:outputText value="#{obecnosc.wartosc}" />
											 </p:column>											  
											  <p:column  filterBy="#{obecnosc.godzinaLekcyjna}" sortBy="#{obecnosc.godzinaLekcyjna}" filterValue="#{frekwencjaLista.filterValues['godzinaLekcyjna']}" headerText="G.l.">
											 		<h:outputText value="#{obecnosc.godzinaLekcyjna}" />
											 </p:column>
											 <p:column filterBy="#{obecnosc.data}" sortBy="#{obecnosc.data}" filterValue="#{frekwencjaLista.filterValues['data']}" headerText="Data" filterMatchMode="contains">
											 		<h:outputText value="#{obecnosc.data}">
											 			<f:convertDateTime pattern="YYYY-MM-dd" locale="pl" />
											 		</h:outputText>
											 </p:column>
											  <p:column filterBy="#{obecnosc.imieNazwiskoUser}" sortBy="#{obecnosc.imieNazwiskoUser}" filterValue="#{frekwencjaLista.filterValues['imieNazwisko']}" headerText="Rejestrujacy" filterMatchMode="contains">
											 		<h:outputText value="#{obecnosc.imieNazwiskoUser}" /> 
											 </p:column>
											 	 <p:column filterBy="#{obecnosc.dataWpisu}" filterValue="#{frekwencjaLista.filterValues['dataWpisu']}" 
											 	 headerText="Data wpisu" filterMatchMode="contains" priority="3">
											 		<h:outputText value="#{obecnosc.dataWpisu}">
											 			<f:convertDateTime pattern="YYYY-MM-dd HH:mm" locale="pl" />
											 		</h:outputText>
											 </p:column>		 	
						</p:dataTable>  
				</p:rowExpansion>
		</p:dataTable>
		<p:blockUI block="sluchaczeObecnoscLista" trigger="sluchaczeObecnoscLista" />  
	 
		</h:form>
	</p:panel>
       <h3>Legenda:</h3>
  			<h:panelGrid columns="2">
  						<p:outputLabel class="m-3" value="N - nieobecność nieusprawiedliwiona"/>
  						<p:outputLabel class="m-3" value="Zs - zwolnienie od innych zajęć słuzbowych"/>
  						<p:outputLabel class="m-3" value="Sp - spóźnienie"/>
  						<p:outputLabel class="m-3" value="L - wizyta u lekarza"/>
  						<p:outputLabel class="m-3" value="C - zwolnienie lekarskie"/>
  						<p:outputLabel class="m-3" value="Sł - służba"/>
  						<p:outputLabel class="m-3" value="Wps - wolne przed i po służbie"/>
  						<p:outputLabel class="m-3" value="Wzn - wolne z tytułu wypracowanych nadgodzin"/>
  						<p:outputLabel class="m-3" value="Wo - urlop okolicznościowy"/>
  						<p:outputLabel class="m-3" value="S - urlop szkoleniowy"/>
  						<p:outputLabel class="m-3" value="Wz - wezwanie do sądu"/>
  						<p:outputLabel class="m-3" value="U - obecność usprawiedliwiona (inne przyczyny)"/>
  			</h:panelGrid>
    </p:outputPanel>
 </ui:define>
<ui:define name="footer"></ui:define>
</ui:composition>